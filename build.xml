<project default="jar">
	<property name="targetdir" value="bin"/>
	<property name="srcdir"    value="src"/>

	<property environment="env"/>

	<fileset id="srcfiles" dir="${srcdir}" includes="**/*.java"/>

	<path id="classpath">
		<fileset id="hadoop_jars" dir="${env.HADOOP_HOME}">
			<include name="hadoop-*.jar"/>
			<include name="lib/*.jar"/>
		</fileset>
		<pathelement path="sam-1.56.jar"/>
		<pathelement path="picard-1.56.jar"/>
	</path>

	<target name="compile">
		<mkdir dir="${targetdir}"/>
		<javac
			srcdir="${srcdir}"
			destdir="${targetdir}"
			source="1.6" target="1.6"
			encoding="UTF-8"
			debug="on"
			includeantruntime="yes"
		>
			<classpath refid="classpath"/>
			<include name="**/*.java"/>

			<compilerarg compiler="modern" value="-Xlint:all,-serial"/>
		</javac>
	</target>
	<target name="jar" depends="compile">
		<jar destfile="hadoop-bam.jar" basedir="${targetdir}">
			<include name="**/*.class"/>
			<manifest>
				<attribute name="Main-Class"
					value="fi.tkk.ics.hadoop.bam.cli.Frontend"/>
			</manifest>
			<service type="fi.tkk.ics.hadoop.bam.cli.CLIPlugin">
				<provider classname="fi.tkk.ics.hadoop.bam.cli.plugins.View"/>
				<provider classname="fi.tkk.ics.hadoop.bam.cli.plugins.Sort"/>
				<provider classname="fi.tkk.ics.hadoop.bam.cli.plugins.Index"/>
				<provider classname="fi.tkk.ics.hadoop.bam.cli.plugins.chipster.Summarize"/>
				<provider classname="fi.tkk.ics.hadoop.bam.cli.plugins.chipster.SummarySort"/>
			</service>
		</jar>
	</target>
	<target name="clean">
		<delete>
			<fileset dir="${targetdir}" includes="**/*.class"/>
		</delete>
	</target>
	<target name="javadoc">
		<javadoc
			destdir="doc"
			locale="en_GB"
			   encoding="UTF-8"
			docencoding="UTF-8"
			source="1.6"
			linksource="yes"
			breakiterator="yes"
			windowtitle="hadoop-bam API documentation"
		>
			<classpath refid="classpath"/>
			<fileset refid="srcfiles"/>
		</javadoc>
	</target>
</project>
